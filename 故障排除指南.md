# SPM Status Monitor 故障排除指南

## 🔧 常见问题解答

### 安装问题

#### Q: 扩展无法在 SillyTavern 中显示

**可能原因：**
1. 文件路径不正确
2. 文件权限问题
3. SillyTavern 版本不兼容

**解决方案：**
```bash
# 1. 检查文件路径
# 正确路径应该是：
SillyTavern/public/scripts/extensions/spm-status-monito/

# 2. 检查文件权限 (Linux/Mac)
chmod -R 755 SillyTavern/public/scripts/extensions/spm-status-monito/

# 3. 验证文件完整性
ls -la SillyTavern/public/scripts/extensions/spm-status-monito/
# 应该包含：manifest.json, index.js, st-extension.js, style.css
```

#### Q: 扩展加载后没有任何反应

**检查步骤：**
1. 打开浏览器开发者工具 (F12)
2. 查看 Console 标签页
3. 寻找 SPM 相关的错误信息

**常见错误和解决方案：**

```javascript
// 错误1: Cannot read property 'getContext' of undefined
// 原因：SillyTavern API 未就绪
// 解决：确保 SillyTavern 完全加载后再启用扩展

// 错误2: Failed to load resource: net::ERR_FILE_NOT_FOUND
// 原因：文件路径错误或文件缺失
// 解决：重新复制扩展文件到正确位置

// 错误3: Uncaught SyntaxError: Unexpected token
// 原因：JavaScript 文件损坏
// 解决：重新下载扩展文件
```

### 功能问题

#### Q: SPM 图标不显示在右下角

**排查步骤：**
1. 确认扩展已启用
2. 检查浏览器控制台错误
3. 尝试手动执行斜杠命令 `/spm show`

**代码检查：**
```javascript
// 在浏览器控制台执行以下代码检查状态
console.log(window.spmMonitor);
// 应该返回扩展对象，如果返回 undefined 说明扩展未正确加载
```

#### Q: 数据不更新或显示为空

**可能原因：**
1. SillyTavern 事件监听失败
2. 数据源访问权限问题
3. 缓存问题

**解决方案：**
```javascript
// 1. 清除缓存
localStorage.removeItem('spm-status-config');
localStorage.removeItem('spm-data-cache');

// 2. 手动刷新数据
/spm refresh

// 3. 检查事件监听状态
/spm debug events
```

#### Q: 移动端界面显示异常

**优化设置：**
```javascript
// 针对移动端的推荐设置
/spm config mobile-mode on
/spm config compact-view on
/spm config touch-friendly on
```

### 性能问题

#### Q: 扩展占用内存过多

**优化措施：**
1. 启用性能模式
2. 减少历史数据保存天数
3. 降低更新频率

```javascript
// 性能优化配置
/spm config performance-mode on
/spm config history-days 7
/spm config update-interval 10000
```

#### Q: 扩展导致 SillyTavern 卡顿

**诊断步骤：**
1. 暂时禁用扩展确认是否为 SPM 导致
2. 检查更新间隔设置
3. 查看内存使用情况

```javascript
// 诊断命令
/spm performance-check
/spm memory-usage
/spm disable-temporarily
```

## 🛠️ 高级故障排除

### 开发者调试

#### 启用详细日志
```javascript
// 在浏览器控制台执行
window.spmMonitor.setLogLevel('debug');

// 或使用斜杠命令
/spm config log-level debug
```

#### 导出诊断信息
```javascript
// 导出完整的诊断报告
/spm export-diagnostics

// 查看扩展状态
/spm status --verbose
```

#### 手动重置扩展
```javascript
// 完全重置扩展状态
/spm reset --all

// 仅重置配置
/spm reset --config-only
```

### 兼容性问题

#### 与其他扩展冲突

**识别冲突：**
1. 逐一禁用其他扩展
2. 观察 SPM 是否正常工作
3. 查看控制台错误信息

**常见冲突扩展：**
- 其他状态监控扩展
- UI 修改扩展
- 大量使用 localStorage 的扩展

**解决方案：**
```javascript
// 设置命名空间隔离
/spm config namespace-isolation on

// 检查冲突
/spm check-conflicts
```

#### 浏览器兼容性

**支持的浏览器版本：**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**检查兼容性：**
```javascript
// 检查浏览器支持情况
/spm check-browser-support
```

## 🔍 错误代码参考

### SPM-001: 初始化失败
```
原因：SillyTavern API 不可用
解决：等待 SillyTavern 完全加载后重试
```

### SPM-002: 配置文件损坏
```
原因：localStorage 中的配置数据损坏
解决：执行 /spm reset --config-only
```

### SPM-003: 网络连接问题
```
原因：无法访问外部资源
解决：检查网络连接，或启用离线模式
```

### SPM-004: 权限不足
```
原因：浏览器安全策略限制
解决：在安全设置中允许本地文件访问
```

### SPM-005: 内存不足
```
原因：可用内存不足
解决：启用性能模式，减少历史数据保存
```

## 📞 获取帮助

### 自助诊断
```javascript
// 运行完整的系统诊断
/spm full-diagnosis

// 生成错误报告
/spm generate-error-report
```

### 提交问题报告

**包含以下信息：**
1. SillyTavern 版本
2. 浏览器类型和版本
3. 操作系统信息
4. 错误截图
5. 控制台错误日志
6. 扩展版本 (v8.7.0)

**问题报告模板：**
```markdown
**环境信息：**
- SillyTavern 版本：
- 浏览器：
- 操作系统：
- SPM 版本：8.7.0

**问题描述：**
[详细描述遇到的问题]

**重现步骤：**
1. 
2. 
3. 

**预期行为：**
[描述期望的正确行为]

**实际行为：**
[描述实际发生的情况]

**错误日志：**
```
[粘贴控制台错误信息]
```

**其他信息：**
[任何其他相关信息]
```

### 联系方式

- **GitHub Issues**: [提交问题](https://github.com/tian2418671-sys/SMPYYZZXX/issues)
- **讨论区**: [GitHub Discussions](https://github.com/tian2418671-sys/SMPYYZZXX/discussions)
- **邮件支持**: <tian2418671@example.com>

## 🔄 恢复和备份

### 创建配置备份
```javascript
// 导出当前配置
/spm export-config backup-20251009.json

// 导出所有数据
/spm export-all-data full-backup-20251009.json
```

### 恢复配置
```javascript
// 从备份恢复配置
/spm import-config backup-20251009.json

// 恢复默认设置
/spm restore-defaults
```

---

**💡 提示：大多数问题可以通过重启 SillyTavern 或清除缓存解决。如果问题持续存在，请参考上述故障排除步骤或联系技术支持。**