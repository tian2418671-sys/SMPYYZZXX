# SPM扩展安装无反应问题排查指南

## 问题现象

扩展安装后没有任何反应，在SillyTavern中看不到SPM相关功能。

## 排查步骤

### 1. 基础检查

1. **确认文件位置**
   - 扩展应位于: `SillyTavern/public/scripts/extensions/third-party/spm-status-monito/`
   - 必需文件: `manifest.json`, `index.js`, `style.css`

2. **检查SillyTavern版本**
   - 确保使用SillyTavern 1.12.x或更高版本
   - 第三方扩展功能需要较新版本支持

### 2. 浏览器控制台检查

1. 打开浏览器开发者工具 (F12)
2. 切换到"Console"标签
3. 刷新页面，查看是否有错误信息
4. 查找以 `[SPM Status Monitor]` 开头的日志

### 3. 扩展加载验证

在浏览器控制台中运行以下命令:

```javascript
// 检查扩展是否加载
console.log('SPM扩展状态:', window.spmStatusMonitor ? '已加载' : '未加载');

// 检查调试信息
if (window.spmDebug) {
    console.log('SPM版本:', window.spmDebug.version);
    console.log('SPM状态:', window.spmDebug.isActive());
}
```

### 4. 手动加载测试

如果扩展未自动加载，尝试手动执行:

```javascript
// 在控制台中粘贴并运行
import('./extensions/third-party/spm-status-monito/index.js')
    .then(() => console.log('SPM扩展手动加载成功'))
    .catch(error => console.error('SPM扩展手动加载失败:', error));
```

### 5. 斜杠命令测试

扩展正常加载后，在聊天输入框中输入:

- `/spm` - 显示/隐藏状态面板

### 6. 常见错误及解决方案

#### 错误: "Failed to fetch"

- **原因**: 文件路径不正确或文件不存在
- **解决**: 检查文件位置，确保所有文件都在正确目录中

#### 错误: "import statement outside module"

- **原因**: SillyTavern版本过旧，不支持ES6模块
- **解决**: 升级到SillyTavern 1.12.x+

#### 错误: "getContext is not defined"

- **原因**: SillyTavern扩展API未正确加载
- **解决**: 等待SillyTavern完全加载后再测试

#### 扩展加载但无界面

- **原因**: CSS样式未加载或被覆盖
- **解决**: 检查 `style.css` 文件，确保CSS正确加载

### 7. 运行诊断脚本

在浏览器控制台中运行以下代码进行自动诊断:

```javascript
// 复制粘贴diagnostic.js的内容到控制台运行
```

### 8. 清除缓存重试

1. 清除浏览器缓存 (Ctrl+Shift+Delete)
2. 硬刷新页面 (Ctrl+F5)
3. 重新启动SillyTavern

### 9. 兼容性检查

确保满足以下要求:

- SillyTavern 1.12.x+
- 现代浏览器 (Chrome 90+, Firefox 88+, Edge 90+)
- 启用JavaScript
- 允许第三方扩展

### 10. 获取帮助

如果以上步骤都无法解决问题，请:

1. 复制浏览器控制台中的完整错误信息
2. 提供SillyTavern版本信息
3. 说明具体的操作步骤和现象
4. 提交GitHub Issue或寻求技术支持

## 成功标志

扩展正常工作时应该看到:

1. 控制台输出: `[SPM Status Monitor] SPM Status Monitor v8.7.0 脚本已加载`
2. 控制台输出: `[SPM Status Monitor] ✅ SPM Status Monitor 初始化完成`
3. 可以使用 `/spm` 命令切换面板显示
4. 页面右上角出现SPM状态面板

## 临时解决方案

如果扩展仍无法正常工作，可以尝试:

1. 使用简化版本的扩展
2. 手动在控制台中运行核心功能
3. 等待后续版本修复
